/*! cackle 12-08-2016 */
angular.module("cackle-admin.settings-module",["cackle-admin.settings-module.controllers","cackle-admin.settings-module.services"]);var pushObject;pushObject=function(a,b,c,d,e){if(0==a.hasOwnProperty(b)){a[b]={};var f=a[b];if(0==c.hasOwnProperty("id"));else{c.id}}else var f=a[b];var g=Object.keys(f);if(g.length>0){var h=Math.max.apply(Math,g)+1,i=f[Object.keys(f)[Object.keys(f).length-1]];1==d?c.id=c.id:c.id=h}else{if(0==c.hasOwnProperty("id"))var j=1;else var j=c.id;c.id=j;var i={};i.id=j-1}1==d?(f[c.id]=c,e&&e()):("undefined"==typeof h&&(h=1),f[h]=c,e&&e())};var obj_key=function(a){return!!angular.isObject(a)&&Object.keys(a)},object_keys=function(a){return Object.keys(a)};angular.module("cackle-admin.settings-module.controllers",["ngSanitize"]),function(){"use strict";function a(a,b,c,d){a.messages={},a.initData=cackle_admin.settings,a.status=cackle_admin.status,a.initData.sites=cackle_admin.sites,a.locale=cackle_locale,a.object_keys=function(a){return Object.keys(a)};var e=function(){a.initData.allow_url_fopen_error&&(a.messages.allow_url_fopen_error={status:!0,text:a.locale.allow_url_fopen_error,class:"md-warn",header:a.locale.Warning}),a.initData.empty_url_error&&(a.messages.empty_url_error={status:!0,text:a.locale["Empty url"],class:"md-warn",header:a.locale.Warning})};a.$watch("initData",function(){e()},!0),a.activate=function(){c.activate(a.initData).then(function(b){a.status=b.data[0],a.messages.hasOwnProperty("activated")?"":a.messages.activated={},a.status.hasOwnProperty("correctKey")&&1==a.status.correctKey?a.messages.activated={status:!0,text:a.locale["Plugin was successfully activated!"],class:"md-success",header:a.locale.Success}:a.messages.activated={status:!1,text:a.locale["The entered keys are wrong. Please check it again. Plugin was not activated"],class:"md-warn",header:a.locale.Warning}},function(a){})};var f=function(b){var c,b="manual_"+b;return c=a.initData[b].hasOwnProperty("finish")&&1!=a.initData[b].finish?a.initData[b].last_post_id:0},g=function(){f("export")&&(a.hasOwnProperty("transfer")?"":a.transfer={},a.transfer.export={messages:[]},a.transfer.export.messages.push(a.locale["Last successfull exported comments was for post_id = "]+f("export"))),f("sync")&&(a.hasOwnProperty("transfer")?"":a.transfer={},a.transfer.sync={messages:[]},a.transfer.sync.messages.push(a.locale["Last successfull synced comments was for post_id = "]+f("sync")))};g();var h=function(a,b){return h.hasOwnProperty("instance")&&"object"==typeof h.instance[a]?("continue"!=b&&(h.instance[a].post_id=0),h.instance[a]):(this.name=a,this.mode=b,this.status=!1,this.post_id="continue"==this.mode?f(a):0,this.hasOwnProperty("message")||(this.messages=[]),h.hasOwnProperty("instance")||(h.instance={}),void(h.instance[a]=this))};h.prototype.transfer_start=function(){a.transfer.hasOwnProperty(this.name)||(a.transfer[this.name]={}),a.transfer[this.name].status=!0;var b=this;a.transfer[b.name].spinner=!0,d(function(){c.transfer(b.name,a.transfer[b.name].post_id).then(function(c){if(console.log(c.data),a.transfer[b.name].spinner=!0,c.hasOwnProperty("data")&&c.data.hasOwnProperty("post_id")){if("fail"!=c.data.result&&(a.transfer[b.name].post_id=c.data.post_id),c.data.hasOwnProperty("post_id")&&null==c.data.post_id&&(a.transfer[b.name].post_id=0),c.data.hasOwnProperty("result")&&"fail"==c.data.result&&null!=c.data.post_id&&(a.transfer[b.name].messages.push(a.locale[[b.name]+"_Processed comments for post_id = "]+c.data.post_id+a.locale["with specified error: "]+(c.data.hasOwnProperty("fail_response")&&null!=c.data.fail_response&&c.data.fail_response.hasOwnProperty("responseApi")?c.data.fail_response.responseApi.error:a.locale["Unable to connect with Cackle"])),a.transfer[b.name].status=!1),c.data.hasOwnProperty("status")&&"partial"==c.data.status&&("success"==c.data.result&&c.data.hasOwnProperty("fail_response")&&null!=c.data.post_id&&a.transfer[b.name].messages.push('<span class="success">'+a.locale[[b.name]+"_Processed comments for post_id = "]+c.data.post_id+"</span>"),1==a.transfer[b.name].status?b.transfer_start():(a.transfer[b.name].messages.push('<span class="warn">'+a.locale[[b.name]+"_Processed comments was stopped for post_id = "]+c.data.post_id+"</span>"),a.transfer[b.name].spinner=!1)),c.data.hasOwnProperty("status")&&"complete"==c.data.status&&"success"==c.data.result){var d="manual_"+b.name;a.initData[d].finish=!0,a.transfer[b.name].messages.push(a.locale[[b.name]+"_Processed comments for post_id = "]+c.data.post_id),a.transfer[b.name].messages.push(a.locale[[b.name]+"_All comments were transfer successfully to Cackle!"]),a.transfer[b.name].spinner=!1,a.transfer[b.name].status=!1}c.data.hasOwnProperty("status")||a.transfer[b.name].messages.push(a.locale[[b.name]+"_Processed comments for post_id = "]+c.data.post_id+a.locale["with specified error: "]+a.locale["Error 500. Unable to connect server. Check server or internet"])}},function(a){})},5e3)},a.transferStart=function(b,c){a.hasOwnProperty("transfer")?"":a.transfer={},a.transfer[b]=new h(b,c),a.transfer[b].transfer_start()},a.orders=[];var i=0,j=0;a.orders_prepared=[],a.transferStop=function(b){a.transfer[b].status=!1};var k=function(b){c.ordersPrepare("orders_send",a.initData.lid).then(function(b){b.hasOwnProperty("status")&&("partial"==b.data.status&&"ok"==b.data.response&&(j+=Object.keys(b.data.orders).length,a.orders.push(j),d(function(){k()},5e3)),"complete"==b.data.status&&(a.orderLoading=!1,a.orders_complete=!0,i=0,j=0))})};a.initOrdersPrepare=function(){a.orderLoading=!0;var b=10;c.ordersPrepare("orders_prepare",a.initData.lid).then(function(d){"partial"==d.data.status&&(c.offset=c.offset+b,i+=d.data.orders_prepared,a.orders_prepared.push(i),a.initOrdersPrepare()),"complete"==d.data.status&&(k(),c.offset=0,console.log(d))})},a.log=function(b,d){c.log(b,a.initData.lid,d).then(function(a){})},a.rating=function(b,d){c.rating("rating",b,a.initData.lid,d).then(function(a){})},a.import_reviews=function(){c.import_reviews(a.initData.lid).then(function(){a.transfer={sync:{messages:[]}},a.transfer.sync.messages.push(a.locale["sync_All comments were transfer successfully to Cackle!"])})},a.changeSite=function(){a.changeSiteSpinner=!0,c.changeSite(a.initData.lid).then(function(b){a.initData=b.data[0],a.initData.sites=cackle_admin.sites,d(function(){a.changeSiteSpinner=!1},1e3)})}}var b="settings.ctrl";angular.module("cackle-admin.settings-module.controllers").controller(b,["$scope","$rootScope","cackleApi","$timeout",a])}(),angular.module("cackle-admin.settings-module.services",[]),function(){"use strict";function a(a,b){var c=function(c){return a({method:"GET",url:b.absUrl(),params:{cackleApi:"checkKeys",value:c}})},d=function(a){return c(a)},e=function(b,c){return a({method:"GET",url:cackle_admin.url,params:{cackleApi:"export",post_id:c,action:b}})},f=function(b,c){"sync"==b&&(b="import");var d=b+"_start";return a({method:"GET",url:cackle_admin.url,params:{cackleApi:b,post_id:c,action:d}})};this.offset=0;var g=function(c,d){return a({method:"GET",url:b.absUrl(),params:"orders_prepare"==c?{cackleApi:c,value:this.offset,lid:d}:{cackleApi:c,lid:d}})},h=function(c){return a({method:"GET",url:b.absUrl(),params:{cackleApi:"change_site",value:c}})},i=function(c,d,e){return"undefined"==typeof e&&(e=""),a({method:"GET",url:b.absUrl(),params:{cackleApi:c,value:e,lid:d}})},j=function(c,d,e,f){return"undefined"==typeof f&&(f=""),a({method:"GET",url:b.absUrl(),params:{cackleApi:c,param:d,value:f,lid:e}})},k=function(c){return a({method:"GET",url:b.absUrl(),params:{cackleApi:"import_reviews",lid:c}})};return{activate:d,_export:e,transfer:f,ordersPrepare:g,log:i,rating:j,import_reviews:k,offset:this.offset,changeSite:h}}var b="cackleApi";angular.module("cackle-admin.settings-module.services").factory(b,["$http","$location",a])}(),angular.module("cackle-admin.Angular",["cackle-admin.settings-module","ngMaterial","ngMessages"]).config(["$mdThemingProvider","$httpProvider",function(a,b){a.theme("default").primaryPalette("blue").accentPalette("orange"),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],b.defaults.transformRequest.push(function(a){var b;if(a){a=JSON.parse(a);for(var c in a)b?b+="&"+c+"="+a[c]:b=c+"="+a[c]}return b}),b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]).filter("objToArray",function(){return function(a,b){for(objectKey in a)objectKey!=b&&"lang"!=objectKey&&(a[objectKey]=1==a[objectKey]);return a}}).directive("errorMessage",function(){return{template:angular.element(document.querySelector("#scopeTemplate")).html(),scope:{error:"=error",errorClass:"=errorclass",header:"=header"}}}).directive("spinner",function(){return{template:'<svg viewBox="0 0 64 64"><g><circle cx="16" cy="32" stroke-width="0" r="5.19334"><animate attributeName="fill-opacity" dur="750ms" values=".5;.6;.8;1;.8;.6;.5;.5" repeatCount="indefinite"></animate><animate attributeName="r" dur="750ms" values="3;3;4;5;6;5;4;3" repeatCount="indefinite"></animate></circle><circle cx="32" cy="32" stroke-width="0" r="4.19334"><animate attributeName="fill-opacity" dur="750ms" values=".5;.5;.6;.8;1;.8;.6;.5" repeatCount="indefinite"></animate><animate attributeName="r" dur="750ms" values="4;3;3;4;5;6;5;4" repeatCount="indefinite"></animate></circle><circle cx="48" cy="32" stroke-width="0" r="3.19334"><animate attributeName="fill-opacity" dur="750ms" values=".6;.5;.5;.6;.8;1;.8;.6" repeatCount="indefinite"></animate><animate attributeName="r" dur="750ms" values="5;4;3;3;4;5;6;5" repeatCount="indefinite"></animate></circle></g></svg>'}}).directive("spinner2",function(){return{template:'<svg width="176px" height="176px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(0 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(30 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.08333333333333333s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(60 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.16666666666666666s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(90 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.25s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(120 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.3333333333333333s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(150 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.4166666666666667s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(180 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.5s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(210 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.5833333333333334s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(240 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.6666666666666666s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(270 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.75s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(300 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.8333333333333334s" repeatCount="indefinite"></animate></rect><rect x="46.5" y="40" width="7" height="20" rx="5" ry="5" fill="#00b2ff" transform="rotate(330 50 50) translate(0 -30)">  <animate attributeName="opacity" from="1" to="0" dur="1s" begin="0.9166666666666666s" repeatCount="indefinite"></animate></rect></svg>'}});